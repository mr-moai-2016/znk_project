Release Note
-----------------------------------

## 2018/08/03 Version 2.1 リリース
  Moai Ver2.1 CipherAgent がリリースされました.

  Version 2.0.2からの修正点は以下の通り.  

~~~
    Moai-Engine本体

    * Moaiアップグレード(Birdman)の導入.
      最近のアプリケーションでは良く見られるボタンを押すだけでソフトウェアを簡単に更新できる機能です.
      Moaiのエンジン設定画面より、「Moaiアップグレード」を選択してアップグレードのためのウィザード画面を表示します.
      この画面において「最新バージョンの確認」⇒「修正パッチのダウンロード」⇒「修正パッチを適用」この３つのボタンを順番に押します.
      これだけで簡単にMoaiを最新バージョンへアップグレードできるというものになります.

    Easter(MoaiCGIアプリケーション)

    * Easter での掲示板閲覧においてhttpsへの対応
      Moaiの(というかローカルプロキシの原理的な)最大の弱点として「フィルタ機能はhttpsでは機能しない」というものがありました.
      今回httpsクライアントとしての能力をも兼ね備えたEasterがMoaiのこの弱点を替わりに克服します.

    * Easter HyperPostによるURL指定での画像投稿機能においてhttpsへの対応
      Easter Ver2.0では画像の参照先URLがhttpsのサイトであった場合は、投稿に失敗するという不具合がありました.
      この不具合を解消します.

    その他

    * httpsを実現するためのライブラリとしてlibresslを導入.
    * make_worldにおいて、不備を修正.
    * mkfgenにおいて、新項目の追加と不備を修正.
    * ドキュメント構成を刷新.
~~~


## 2018/05/02 Version 2.0.2 リリースおよび修正パッチ.

~~~
    Moai-Engine本体

    * Moai CGI に(自立実行形式ではない)インタープリタ型のCGIスクリプトを実行させた場合、
      カレントディレクトリのセッティングが行われていなかったため、多くのケースでこれが起動できないことがわかりました.
      (例えばphpスクリプトではこの問題が発生せず、rubyやpythonスクリプトなどではこの問題が発生します.)
      今回これを修正しています.
~~~


## 2018/04/28 Version 2.0.1 修正パッチ.

~~~
    Easter(MoaiCGIアプリケーション)

    * 赤福と一緒に使っている場合、極一部の環境でオートリンク機能がうまく機能しないケースがあることがわかりました.
      これを修正しています.
~~~

## 2018/04/27 Version 2.0 リリース.  
  大変お待たせいたしました！
  ついに次世代のMoai Ver2.0のリリースです.

  Version 1.1.8からの修正点は以下の通り.  

~~~
    Moai-Engine本体

    * Moai CGIシステムの導入.
    * Moai Web Configuration画面の刷新.
    * 新防衛機構XhrDMZの導入(Port番号としてMoai本体の8124とは別に8125を使用).
    * Moai認証コードの導入.
      Moai CGI内でこの認証コードを検査し、正規の手順で発行されたMoai CGIの命令かどうかを判定できる.
    * moai_logの肥大化対策. 循環式ログを導入.
    * EAGAINが連発する現象の緩和. wait間隔を調整することで対応.
    * 旧コードのうち汎用性の高いものをlibRanoとして分離.
    * http_decoratorを廃止し、これへの依存性も除去. 替わりにRano_htp_boyを使う形に変更.
    * Rano_htp_modifierの導入により、HTTP系のフィルター機能において仮想アルゴリズムを大幅に強化.
    * 各種Bug fix.

    VirtualUSERS(MoaiCGIアプリケーション)

    * 新規導入. 
    * 旧バージョンのMoaiにあったVirtual USERS Initiate ボタンを廃止し、
      この機能を後継したMoai CGIアプリケーション.
    * user_agent.txt および screen_size.txtを廃止.
      ユーザはもはやこれらに候補を記述しておく必要はなく、User-Agent、Screen-Size、そしてすべて(Everything)の情報は
      CustomBoy-Engineにより無の状態から自動的に構築される.
    
    Easter(MoaiCGIアプリケーション)
    
    * 新規導入. 
    * ローカルプロキシの設定をせずともVirtualUSERSで構築した仮想ブラウザ環境を利用できるビューア.
    * 画像BBSで入手した画像の分類や管理などもできる.
    
    CustomBoy-Engine(MoaiCGIアプリケーション)
    
    * 新規導入. 
    * 仮想ブラウザ環境を構築するコアエンジン.
    * 我々が提供する仮想化ツールの中でもこれは最強のカスタマイズ性を有する.
    
    ProxyFinder(MoaiCGIアプリケーション)
    
    * 新規導入. 
    * プロキシ情報サイトにアクセスしプロキシのリスト(parent_proxy.txt)を自動生成する.
    
    新ビルドシステムmkfsys
    
    * 新規導入. 
    * znk_projectが提唱する新しいMakefile自動生成型ビルドシステムである.
      MoaiやEasterなどはすべてこのビルドシステムを採用している.
~~~

## 2016/10/13 Version 1.1.8 リリース.  
  以下を修正しました.

~~~
    * ふたばのスレの下部にある[リロード]を押すと、正常に応答しなくなるバグを修正.
      またFirefox+赤福においてふたばに画像レス投稿などを行うと同様に応答しなくなるか
      あるいはその応答が著しく遅くなるバグを修正.

      MoaiはContent-Lengthの値を参照し、その後に通信すべきデータサイズの残量を管理していますが、
      このバグはHTTPパイプライン化とHEADリクエストが同時に発生するケースにおいて、
      その残量を適切にリセットしてなかったことにより発生していました.
      また、POSTリクエストがそのようなケースの直前に発生した場合もほぼ同様の理由により
      同様の不具合が発生していました.
      今回の修正では、その残量値のリセット処理を行ってあります.
~~~

## 2016/10/07 Version 1.1.7 リリース.  
  以下を修正しました.

~~~
    * ふたばの新しい仕様への対応.
      Virtual USERS Initiate機能においてPost変数ptuaの自動ランダマイズに対応しました.
~~~

## 2016/07/13 Version 1.1.6 リリース.  
  以下を修正しました.

~~~
    * recv_filterにおいてcss_addtional というセクションを新たに導入.
      この部分にユーザ独自のcssを追加で記述できるようになりました.
      これにより閲覧しているページのスタイルを比較的容易にカスタマイズできます.

    * Virtual USERS Initiate機能におけるuser_agent生成に関してそのデフォルト値を若干改良.
      user_agent.txtにデフォルトで記載されている候補値をPC版とAndroidで別々としました.
      またこのときに使用する乱数計算式に偏りがあったのを修正しました.

    * ふたばの新しいサーバへの対応.
      ふたばにおいて test.2chan.net という新しいサーバが導入されています.
      また base4.js に sendBeaconと呼ばれる処理が追加されており、この新しいサーバ test.2chan.net へ
      空の値がPOSTされるようになっています. このとき User-Agentの値も一緒に送信されますが
      HTTPS接続となっているため、現バージョンのMoaiでこのUser-Agentの値を偽装することはできません.
      (真の値が送られてしまいます).

      sendBeaconに関してはサポートされていないブラウザや、サポートされている場合でも設定により
      無効化されている場合もあるので、そのことを鑑みてとりあえず今回はこのサーバへの接続を
      ignored_host機能によりデフォルトで強制ブロックして様子をみる形にしてあります.
~~~

## 2016/07/07 Version 1.1.5 リリース.  
  以下を修正しました.

~~~
    * ふたばプラグインを修正.  
      ふたばの仕様変更に対する修正となります.

      現在、POST変数ptuaに関して、これを加工するJavascriptがページの最後部分に追加されています.
      またある種の文字列置換を単純に行うとこのJavascript部分にも影響が波及し、その結果として
      ページが正常に表示されなくなったりレス投稿などができなくなる可能性が懸念されます.
      この問題に対する措置を今回行っております.
~~~

## 2016/07/06 Version 1.1.4 リリース.  
  以下を修正しました.

~~~
    * ふたばプラグインを修正.  
      ふたばの仕様が大きく変更されました. これに対する修正となります.

    * filters/futaba_recv.myf を修正.
      今回、以下のフィルタ文がすべて削除されています.

        replace ['</iframe>'] ['</iframe -->']
        replace ['</iframe'] ['</iframe --><noscript></noscript']
        replace ['display: '] ['display:']
        replace ['display:none'] ['display:inline']
        replace ['display: '] ['dasplay: ']
~~~


## 2016/07/04 Version 1.1.3 リリース.  
  以下を修正しました.

~~~
    * ふたばプラグインを修正.
      現状、ふたばにはscriptタグ内におけるコメントアウト内に、ある条件下で正常な表示を阻害するパターンが含まれています.
      これを除去するサニタイズ機構を導入しました.
    * filters/futaba_recv.myf を修正.
~~~


## 2016/07/03 Version 1.1.2 リリース.  
  以下を修正しました.

~~~
    * ふたばプラグインを修正.
      現状、ふたばにはHTMLコメントアウト内に、ある条件下で正常な表示を阻害するパターンが含まれています.
      これを除去するサニタイズ機構を導入しました.
    * filters/futaba_recv.myf を修正.
~~~


## 2016/07/01 Version 1.1.1 リリース.  
  以下を修正しました.

~~~
    * プラグインにおけるon_post関数の仕様を変更.
      この関数の新しい引数としてhdr_varsを追加.
      これにより現在のHTTP Headerの値に応じて処理をより柔軟に切り替えることが可能となります.
    * MoaiModule_filtHtpHeader を適用するタイミングを変更.
      send_filter の header_vars のフィルタリングが適用されるタイミングは
      on_post, on_response プラグイン関数の呼び出しより後となります.
    * ふたばの新しい仕様に対応するため、ふたばプラグインを修正.
~~~


## 2016/06/30 Version 1.1 リリース.  
  以下を修正しました.

~~~
    * プラグインにおけるon_post関数の仕様を変更.
      この関数の新しい引数としてpost_varsを追加.
      これにより現在のPOST変数の値に応じて処理をより柔軟に切り替えることが可能となります.
    * ふたばの新しい仕様に対応するため、ふたばプラグインを修正.
    * libZnkのバージョンを1.1に変更.
      Ver1.0までにあったlibZnkのDeprecatedな公開関数を削除.
      (これによりlibZnk Ver1.0との互換性はなくなっています).
~~~


## 2016/06/21 Version 1.0.7 リリース.  
  以下を修正しました.

~~~
    * ふたばの新しい仕様に対応.
      POST変数ptuaにnavigator.userAgentの値を設定するようふたばの仕様が変更されています.
      それに対応する修正となります.
    * Androidのビルドと起動系のスクリプトを若干改良.
~~~


## 2016/06/21 Version 1.0.6 リリース.  
  Androidユーザの皆様！おまたせしました！
  ついに Moai for Android (試験的バージョン)の登場です.
  今回我々開発チームがAndroid向けにコンパイルしたものをbin_for_androidとしてご提供します.
  そしてまた、あなたがAndroid向けにコンパイルするための指針をHowToCompileにて解説してあります.

~~~
    * libZnkを arm および aarch64 環境でもコンパイル可能なように修正.
    * android-ndkによるビルドスクリプトを追加.
    * Android用にコンパイルしたbin_for_androidを試験的に追加.
      現時点では experimental compile version(実験的コンパイルバージョン)という位置づけであり、
      armeabi, armeabi-v7a, x86(android-x86エミュレータ用)の3つのバイナリがあります.
    * HowToCompileにおいてAndroid NDKでビルドするための解説を追加.
~~~


## 2016/06/13 Version 1.0.5 リリース.  
  以下を修正しました.

~~~
    * Cygwinにおいてコンパイルが出来なくなっていた問題を修正.
      Cygwin向けのMakefileおよびコンパイル/インストールスクリプトを追加.
      またCygwinにおけるMoaiの問題ある動作を改良.
      (Cygwin上でMoaiをコンパイルして使いたいがうまくいかなかったという方、
      かなり簡単になったと思いますので、是非ともお試しください)

    * HowToCompileにおけるCygwin/Linuxにおける解説をより詳細なものに改良.
~~~


## 2016/06/01 Version 1.0.4 リリース.  
  以下を修正しました.
  ここからのMoaiの大きな構想として「作者の手を離れたツール」を目指します.
  そのためにはより使いやすくわかりやすく簡単な仕様を目指す必要があります.
  またpluginに関してはまだまだドキュメント不足なため、これを整備していく必要もあります.

~~~
    * リファレンスマニュアルにある送信filterに関するドキュメントを改良.
      header_vars、post_vars、cookie_vars 指定それぞれに関してより詳細に言及し、
      それぞれに関する練習用例題とその解説などを追加.
      最終的にはプログラミングなど特別なスキルを持たない一般ユーザでも自力で独自の送信用filterを
      無理なく作成できるよう導くようなドキュメントの完備を目指す.

    * Cookie用のフィルタ cookie_vars の仕様が一部複雑であるため、例えば単に問答無用で
      あるCookie変数を空値に設定しておきたい場合など、以前のバージョンでは一工夫する必要があった.
      これをより簡易に直感的に記述できるよう、新たにcookie_forceという指定を追加.
      記法はcookie_varsと全く同じだが、ここに指定したCookie変数は問答無用で強制的にその値に矯正される.

    * その他若干のバグ修正やコード整理など
~~~


## 2016/05/27 Version 1.0.3 リリース.  
  以下の不具合を修正しました.

~~~
    * Ver1.0.2においてロードが極端に遅くなる不具合を修正.
      (この不具合は、304 Not Modified等の受信時にContent-Lengthが0の場合、
      HTTP Bodyを未知サイズとみなして力づくでrecvしようとしていたというもの.
      これをステート200以外はContent-Lengthの指定に従い、HTTP Bodyを0サイズとみなして
      それ以上recvしないように修正)
~~~


## 2016/05/27 Version 1.0.2 リリース.  
  以下の不具合を修正しました.

~~~
    * libZnkにあった重大なバグを修正.
      このバグはZnk_memrchrの実装ミスとなります.
    * Cookieのフィルタ処理が場合によってはうまく機能しないことが有り得る問題を修正.
      これに伴い、pluginやfilterも若干修正.
    * Virtual USERS Initiate ボタンを押した場合に表示されるメッセージを
      もっと詳細なものに変更.
~~~


## 2016/05/25 Version 1.0.1 リリース.  
  以下の不具合を修正しました.

~~~
    * IE7以前で画像投稿した場合に、そのファイル名がフルパスで送られてしまう問題.
      (フルパスを強制的に除去しファイル名だけにした上で送られるように修正).
    * アップローダ「斧」においてファイルのダウンロード開始に導く最終ページにおいて
      発生する不具合を修正.
~~~


## 2016/05/21 Version 1.0 リリース.  
  正式バージョン.  

  旧バージョンからテストにご協力戴いた方へ：  
  こんな風変わりなツールに付き合っていただきありがとう！
  この場で感謝申し上げます.
  長くなりましたがさらに完成度を高め、ついに正式にして安定バージョンのリリースです.

  Version 0.9からの修正点は以下の通り.  
~~~
    * virtual_users(virtual_users.exe)という名前の実行バイナリを削除.
      このバイナリがもたらす機能はもはやpluginとして完全に分離された.
      そもそもvirtual_usersという実行バイナリは、futaba用の処理を最初に処理した後、
      moaiを呼び出すことでこの分離不完全性に対してお茶を濁していた仮の姿であった.
      pluginの完全化により「Virtual USERS」というフレーズはツールとしてでなく機能としての名称となる.
      旧バージョンでは裏方であったMoaiこそが、実はこのプロジェクトの表紙を飾る真のツールである!
      (え？知ってたって？）

    * config.myfにあったproxy_plus proxy_minusという項目は削除し、これをproxy_apply proxy_exceptという名前に変更.
      またこれらでワイルドカード指定が行えるようにした.
    * config.myfにあったproxy_indicating_modeという項目は廃止.
    * Ver0.9では parent_proxyメニューにおいてproxyを切り替えた後にそのproxyが無効になった場合
      次回moaiの起動時にフリーズするという大きな問題があった.
      これに対処するため、Virtual USERSのランダムなフィルタ仮想化をmoai起動時ではなく、
      Web Configuration上の「Virtual USERS Intiation」ボタン押下で行うように仕様を変更した.
      尚、旧バージョンのように起動時にこれを行いたい場合は コマンドライン引数に --initiate を指定してmoaiを実行する.
    * config.myfにenable_log_verboseを追加.

    * ソケット通信における非ブロッキング接続とHTTPにおけるパイプライン化に対する中継をサポート.
      旧バージョンでは複数のタブを開いて同時に接続した場合、最初の接続が終るまで２番目３番目の接続が
      ブロックされ待たされていたが、この問題を解決した形となる. これにより体感的にも閲覧が大幅に高速化される.

    * いわゆる許可されていないIPに対するForbidden機能をサポート.
      この機能により、acceptable_hostをANYにした場合の安全性が大幅に改善される.

    * application/x-www-form-urlencoded方式によりPOSTするタイプの掲示板(２ちゃんねるなど)でPOST変数の送信フィルタ
      が機能していなかった実装の不備を修正.
    * pluginの仕様を整理.
    * 2ch用のpluginを追加.
    * Web Configurationでのいくつかの使いづらい挙動を修正.
    * Firefox赤福などが有効な場合で post_confirmがonの場合に処理が競合しレスができない問題がある.
      これを回避するため、とりあえずデフォルトではpost_confirmをoffとした.
    * その他雑多なBugを徹底的に洗い出し修正.

    * libZnkのバージョンを1.0とした.
      このリリースでのすべてのプロジェクトはこのバージョン1.0ベースで動作する.
      旧バージョン0.9のdllやsoとは互換性がないので注意.
    * ドキュメントの構成を変更.
      また、FAQ(過去に行われた質問と回答集)とHacking(プログラマ向け改造およびプラグイン拡張ガイド)を追加.
~~~


## 2016/04/29 Version 0.9 リリース.  
  β-テストバージョン.  
  Version 0.8からの修正点は以下の通り.  
~~~
    * デフォルト名が強制的に「モア!!モア!!モアーイ」になってしまう不具合を修正(失敬ｗ.
    * デフォルトポートを8123から8124へ変更(やはりPolipoと被ると不便なので)
    * config.myfにあったproxy_nextという項目は削除し、これをparent_proxy_listという名前に変更.
    * コマンドライン引数から外部proxyのIPアドレスとポート番号を指定する方式を廃止.
      (替わりにconfig.myfのparent_proxy_list指定を使うこと)
    * config.myfにあったmaster_confirmという項目を削除し、これをpost_confirmという名前に変更.
    * analysis.myfにあったconfirm_hostsという項目を削除し、これをconfig.myf内に移動.
      さらに post_confirm_hosts という名前に変更.
    * 受信フィルタにおいてCSS, JSフィルタが未サポートであったのを修正. 機能するようにした.
    * 外部プロキシに関する設定と中継がうまく機能していなかった不具合を修正.
    * config.myfにおいてproxy_indicating_mode, proxy_minus, proxy_plus指定を追加. 
    * config.myfにおいてenable_log_fileを追加.
    * config.myfにおいてacceptable_host, server_nameを追加.

    * libZnkのバージョンを0.9とした.
      このリリースでのすべてのプロジェクトはこのバージョン0.9ベースで動作する.
      旧バージョン0.8のdllやsoとは互換性がないので注意.

    * HowToCompileにあった MinGWを使用する場合における誤った記述を修正.
      ここでうまくいかずコンパイルを投げた方がおられたら申し訳ない.
      ZNK_MINGW_DIR を設定するべきbatファイルは正しくはbat_utils/setenv_mingw.batとなります.

    * LAN上における他のマシンからの接続をサポート.
      旧バージョン0.8では自マシン以外は問答無用で遮断していたが、この制限を排除した形となる.
      これはご家庭にある２台目３代目のマシン等から、Visual USERSの起動している１台目のマシンへ接続して
      Virtual USERSの提供する機能を利用するといったような用途を想定している.
      この制限は、config.myf内のacceptable_hostにおいて切り替えることができる.
      この値でANYを指定することにより他のマシンからの接続が可能となり、
      LOOPBACKを指定することにより、旧バージョン0.8と同様自マシン以外は問答無用で遮断するようになる.
      デフォルトでは安全のため、一応LOOPBACKとしてある.
      この値をANYとする場合は、ルータやOSなどにあるファイアウォール機能で
      WAN(外部インターネット)からのポート8124への接続ができないようきちんと防御すること.
      (通常、デフォルトでは防御されているはずであるけれども)

    * localhost:8124/config より表示されるConfig画面を機能強化.
    * 各種ドキュメントの整備と刷新.
~~~


## 2016/04/21 Version 0.8 リリース.  
  α-テストバージョン.  
  初回リリース.

